<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant CashFlow Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Terracotta & Sage Color Palette */
            --primary: #C67B5C; /* Terracotta */
            --primary-dark: #A65C3F;
            --secondary: #87A878; /* Sage */
            --secondary-dark: #6B8A5F;
            --accent: #D4A574; /* Sandy beige */
            --success: #7FAA65;
            --danger: #C85A54;
            --warning: #E0A458;
            --bg-light: #F8F6F3;
            --bg-card: #FFFFFF;
            --text-primary: #3E3E3E;
            --text-secondary: #6B6B6B;
            --border: #E5DED6;
            --sidebar-width: 280px;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 4px 16px rgba(0, 0, 0, 0.12);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            background: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* ===== AUTHENTICATION SCREEN ===== */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
        }

        .auth-box {
            background: var(--bg-card);
            padding: 3rem 2.5rem;
            border-radius: 1rem;
            box-shadow: var(--shadow-hover);
            max-width: 420px;
            width: 100%;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-header h1 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .auth-header p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s;
            background: var(--bg-light);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(198, 123, 92, 0.1);
        }

        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
            width: 100%;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--secondary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .error-message {
            background: #FEE;
            color: var(--danger);
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* ===== MAIN APP LAYOUT ===== */
        .app-container {
            display: none;
        }

        .app-container.active {
            display: flex;
            min-height: 100vh;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            transition: transform 0.3s;
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-header .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.85rem;
            margin-top: 0.25rem;
            font-weight: 400;
        }

        .nav-menu {
            padding: 1rem 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .nav-item:hover {
            background: rgba(198, 123, 92, 0.08);
            color: var(--primary);
        }

        .nav-item.active {
            background: rgba(198, 123, 92, 0.12);
            border-left-color: var(--primary);
            color: var(--primary);
        }

        .nav-icon {
            font-size: 1.25rem;
            min-width: 1.75rem;
            text-align: center;
        }

        .user-section {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            background: var(--bg-light);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .user-details h3 {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-details p {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 2rem;
            background: var(--bg-light);
            min-height: 100vh;
        }

        .section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-header h2 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* ===== CARDS ===== */
        .card {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            transition: all 0.3s;
        }

        .card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* ===== STAT CARDS ===== */
        .stat-card {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 1.75rem;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .stat-card.revenue::before {
            background: linear-gradient(90deg, var(--success), var(--secondary));
        }

        .stat-card.expense::before {
            background: linear-gradient(90deg, var(--danger), var(--primary));
        }

        .stat-card.profit::before {
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            font-size: 2rem;
            opacity: 0.3;
        }

        .stat-value {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .stat-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* ===== GRIDS ===== */
        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        }

        /* ===== FORMS ===== */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.3s;
            background: var(--bg-light);
            color: var(--text-primary);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(198, 123, 92, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* ===== TABLES ===== */
        .table-container {
            overflow-x: auto;
            border-radius: 0.75rem;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: var(--bg-light);
        }

        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
        }

        tbody tr {
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: rgba(198, 123, 92, 0.03);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .badge {
            display: inline-block;
            padding: 0.35rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-revenue {
            background: rgba(127, 170, 101, 0.15);
            color: var(--success);
        }

        .badge-expense {
            background: rgba(200, 90, 84, 0.15);
            color: var(--danger);
        }

        /* ===== ACTION BUTTONS IN TABLE ===== */
        .action-btns {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            padding: 0.5rem;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 0.375rem;
            transition: all 0.2s;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .btn-icon:hover {
            background: var(--bg-light);
            color: var(--primary);
        }

        .btn-icon.delete:hover {
            background: rgba(200, 90, 84, 0.1);
            color: var(--danger);
        }

        /* ===== TOAST NOTIFICATIONS ===== */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: white;
            color: var(--text-primary);
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow-hover);
            display: none;
            align-items: center;
            gap: 0.75rem;
            z-index: 1000;
            min-width: 280px;
            border-left: 4px solid var(--primary);
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.show {
            display: flex;
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        /* ===== MOBILE MENU ===== */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 56px;
            height: 56px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 99;
            box-shadow: var(--shadow-hover);
            transition: all 0.3s;
        }

        .mobile-menu-btn:hover {
            transform: scale(1.1);
            background: var(--primary-dark);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .page-header h2 {
                font-size: 1.5rem;
            }

            .stat-value {
                font-size: 1.75rem;
            }

            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .auth-box {
                padding: 2rem 1.5rem;
            }

            table {
                font-size: 0.875rem;
            }

            th, td {
                padding: 0.75rem 0.5rem;
            }
        }

        /* ===== LOADING SPINNER ===== */
        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== FILTERS ===== */
        .filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: white;
            border-radius: 0.75rem;
            border: 1px solid var(--border);
        }

        .filter-item {
            flex: 1;
            min-width: 200px;
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .empty-state p {
            font-size: 1rem;
            margin-bottom: 1.5rem;
        }

        /* ===== QUICK STATS ===== */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 0.75rem;
            border: 1px solid var(--border);
        }

        .quick-stat {
            text-align: center;
            padding: 0.75rem;
        }

        .quick-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .quick-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ===== SETTINGS SECTION ===== */
        .settings-grid {
            display: grid;
            gap: 1.5rem;
        }

        .settings-section {
            background: white;
            padding: 2rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border);
        }

        .settings-section h3 {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 0.75rem;
        }

        .sync-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-light);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        .sync-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .sync-indicator.disconnected {
            background: var(--text-secondary);
            animation: none;
        }
    </style>
</head>
<body>
    <!-- Authentication Screen -->
    <div id="authContainer" class="auth-container">
        <div class="auth-box">
            <div class="auth-header">
                <h1>üçΩÔ∏è CashFlow Tracker</h1>
                <p>Restaurant Financial Management</p>
            </div>
            <div id="authError" class="error-message"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email Address</label>
                    <input type="email" id="loginEmail" placeholder="admin@cashmany.com" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn btn-primary">Login</button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appContainer" class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>üçΩÔ∏è CashFlow</h1>
                <div class="subtitle">Restaurant Tracker</div>
            </div>
            <nav class="nav-menu">
                <div class="nav-item active" onclick="showSection('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="showSection('transactions')">
                    <span class="nav-icon">üí∞</span>
                    <span>Transactions</span>
                </div>
                <div class="nav-item" onclick="showSection('reports')">
                    <span class="nav-icon">üìà</span>
                    <span>Reports</span>
                </div>
                <div class="nav-item" onclick="showSection('settings')">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Settings</span>
                </div>
            </nav>
            <div class="user-section">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <h3 id="userName">Admin User</h3>
                        <p id="userEmail">admin@cashmany.com</p>
                    </div>
                </div>
                <button class="btn btn-danger btn-sm" onclick="logout()">Logout</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <div class="page-header">
                    <h2>Dashboard</h2>
                    <!-- <div class="btn-group">
                        <button class="btn btn-primary" onclick="showAddTransaction('revenue')">+ Add Revenue</button>
                        <button class="btn btn-secondary" onclick="showAddTransaction('expense')">+ Add Expense</button>
                    </div> -->
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-4">
                    <div class="stat-card revenue">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Total Revenue</div>
                                <div class="stat-value" id="statRevenue">‚Çπ0</div>
                                <div class="stat-change positive">
                                    <span>‚Üë</span>
                                    <span id="revenueChange">0%</span> vs last month
                                </div>
                            </div>
                            <div class="stat-icon">üíµ</div>
                        </div>
                    </div>

                    <div class="stat-card expense">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Total Expenses</div>
                                <div class="stat-value" id="statExpense">‚Çπ0</div>
                                <div class="stat-change negative">
                                    <span>‚Üë</span>
                                    <span id="expenseChange">0%</span> vs last month
                                </div>
                            </div>
                            <div class="stat-icon">üí∏</div>
                        </div>
                    </div>

                    <div class="stat-card profit">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Net Profit</div>
                                <div class="stat-value" id="statProfit">‚Çπ0</div>
                                <div class="stat-change" id="profitChange">
                                    <span>‚Üë</span>
                                    <span>0%</span> vs last month
                                </div>
                            </div>
                            <div class="stat-icon">üìä</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-label">Transactions</div>
                                <div class="stat-value" id="statTransactions">0</div>
                                <div class="stat-change">
                                    <span>This month</span>
                                </div>
                            </div>
                            <div class="stat-icon">üìù</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats" style="margin-top: 1.5rem;">
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="avgDailyRevenue">‚Çπ0</div>
                        <div class="quick-stat-label">Avg Daily Revenue</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="avgDailyExpense">‚Çπ0</div>
                        <div class="quick-stat-label">Avg Daily Expense</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="profitMargin">0%</div>
                        <div class="quick-stat-label">Profit Margin</div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3 class="card-title">Recent Transactions</h3>
                        <button class="btn btn-sm btn-secondary" onclick="showSection('transactions')">View All</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Notes</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentTransactionsTable">
                                <tr>
                                    <td colspan="6" class="empty-state">
                                        <div class="empty-state-icon">üìù</div>
                                        <p>No transactions yet. Add your first transaction!</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Transactions Section -->
            <section id="transactions" class="section">
                <div class="page-header">
                    <h2>All Transactions</h2>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="showAddTransaction('revenue')">+ Add Revenue</button>
                        <button class="btn btn-secondary" onclick="showAddTransaction('expense')">+ Add Expense</button>
                    </div>
                </div>

                <!-- Add Transaction Form -->
                <div id="addTransactionForm" class="card" style="display: none; margin-bottom: 2rem;">
                    <div class="card-header">
                        <h3 class="card-title" id="formTitle">Add Transaction</h3>
                        <button class="btn-icon" onclick="hideAddTransaction()">‚úï</button>
                    </div>
                    <form id="transactionForm">
                        <input type="hidden" id="editTransactionId">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="transactionType">Type</label>
                                <select id="transactionType" required onchange="updateCategoryOptions()">
                                    <option value="revenue">Revenue</option>
                                    <option value="expense">Expense</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="transactionCategory">Category</label>
                                <select id="transactionCategory" required>
                                    <option value="">Select Category</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="transactionDate">Date</label>
                                <input type="date" id="transactionDate" required>
                            </div>
                            <div class="form-group">
                                <label for="transactionAmount">Amount (z≈Ç)</label>
                                <input type="number" id="transactionAmount" step="0.01" min="0" required placeholder="0.00">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="transactionNotes">Notes (Optional)</label>
                            <textarea id="transactionNotes" placeholder="Add any additional notes..."></textarea>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">Save Transaction</button>
                            <button type="button" class="btn btn-secondary" onclick="hideAddTransaction()">Cancel</button>
                        </div>
                    </form>
                </div>

                <!-- Filters -->
                <div class="filters">
                    <div class="filter-item">
                        <label>Filter by Type</label>
                        <select id="filterType" onchange="applyFilters()">
                            <option value="all">All Types</option>
                            <option value="revenue">Revenue Only</option>
                            <option value="expense">Expense Only</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>Filter by Category</label>
                        <select id="filterCategory" onchange="applyFilters()">
                            <option value="all">All Categories</option>
                        </select>
                    </div>
                    <div class="filter-item">
                        <label>Date From</label>
                        <input type="date" id="filterDateFrom" onchange="applyFilters()">
                    </div>
                    <div class="filter-item">
                        <label>Date To</label>
                        <input type="date" id="filterDateTo" onchange="applyFilters()">
                    </div>
                </div>

                <!-- Transactions Table -->
                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Type</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Notes</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="allTransactionsTable">
                                <tr>
                                    <td colspan="6" class="empty-state">
                                        <div class="empty-state-icon">üìù</div>
                                        <h3>No Transactions Found</h3>
                                        <p>Start by adding your first revenue or expense transaction</p>
                                        <button class="btn btn-primary" onclick="showAddTransaction('revenue')">Add Transaction</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="section">
                <div class="page-header">
                    <h2>Reports & Analytics</h2>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="exportToPDF()">üìÑ Export PDF</button>
                        <button class="btn btn-secondary" onclick="exportToCSV()">üìä Export CSV</button>
                    </div>
                </div>

                <!-- Report Period Selection -->
                <div class="card" style="margin-bottom: 2rem;">
                    <h3 class="card-title">Report Period</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reportStartDate">Start Date</label>
                            <input type="date" id="reportStartDate" onchange="generateReport()">
                        </div>
                        <div class="form-group">
                            <label for="reportEndDate">End Date</label>
                            <input type="date" id="reportEndDate" onchange="generateReport()">
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
                        </div>
                    </div>
                </div>

                <!-- Report Summary -->
                <div class="grid grid-3" id="reportSummary">
                    <!-- Report cards will be generated here -->
                </div>

                <!-- Category Breakdown -->
                <div class="card" style="margin-top: 2rem;">
                    <h3 class="card-title">Category Breakdown</h3>
                    <div id="categoryBreakdown" class="table-container">
                        <p class="empty-state">Select a date range and generate a report</p>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="section">
                <div class="page-header">
                    <h2>Settings</h2>
                </div>

                <div class="settings-grid">
                    <!-- Google Sheets Integration -->
                    <div class="settings-section">
                        <h3>üìä Google Sheets Integration</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                            Connect your Google Sheet to automatically sync all transactions. Every entry will be saved to your spreadsheet in real-time.
                        </p>
                        <div class="form-group">
                            <label for="sheetsUrl">Google Sheets URL</label>
                            <input type="url" id="sheetsUrl" placeholder="https://docs.google.com/spreadsheets/d/...">
                        </div>
                        <div class="form-group">
                            <label for="sheetName">Sheet Name (Tab Name)</label>
                            <input type="text" id="sheetName" placeholder="Transactions" value="Transactions">
                        </div>
                        <div class="form-group">
                            <label for="sheetsApiUrl">App Script Web App URL</label>
                            <input type="url" id="sheetsApiUrl" placeholder="https://script.google.com/macros/s/.../exec">
                            <small style="display: block; margin-top: 0.5rem; color: var(--text-secondary);">
                                Get this URL after deploying the App Script (instructions provided below)
                            </small>
                        </div>
                        <button class="btn btn-primary" onclick="testSheetsConnection()">Test Connection</button>
                        <button class="btn btn-secondary" onclick="saveSheetsSettings()">Save Settings</button>
                        <div class="sync-status" style="margin-top: 1rem;">
                            <div class="sync-indicator disconnected" id="syncIndicator"></div>
                            <span id="syncStatus">Not Connected</span>
                        </div>
                    </div>

                    <!-- Account Settings -->
                    <div class="settings-section">
                        <h3>üë§ Account Settings</h3>
                        <div class="form-group">
                            <label for="settingsEmail">Email</label>
                            <input type="email" id="settingsEmail" value="admin@cashmany.com" disabled>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" placeholder="Leave blank to keep current">
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm Password</label>
                            <input type="password" id="confirmPassword" placeholder="Confirm new password">
                        </div>
                        <button class="btn btn-primary" onclick="changePassword()">Update Password</button>
                    </div>

                    <!-- Restaurant Settings -->
                    <div class="settings-section">
                        <h3>üè™ Restaurant Settings</h3>
                        <div class="form-group">
                            <label for="restaurantName">Restaurant Name</label>
                            <input type="text" id="restaurantName" placeholder="My Restaurant">
                        </div>
                        <div class="form-group">
                            <label for="currency">Currency</label>
                            <select id="currency">
                                <option value="z≈Ç">z≈Ç (PLN)</option>
                                <option value="$">$ (USD)</option>
                                <option value="‚Ç¨">‚Ç¨ (EUR)</option>
                                <option value="¬£">¬£ (GBP)</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="saveRestaurantSettings()">Save Settings</button>
                    </div>

                    <!-- Data Management -->
                    <div class="settings-section">
                        <h3>üíæ Data Management</h3>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <button class="btn btn-secondary" onclick="backupData()">üì• Download Backup</button>
                            <div class="form-group" style="margin: 0;">
                                <label for="importFile">Import Data</label>
                                <input type="file" id="importFile" accept=".json,.csv" style="padding: 0.5rem;">
                            </div>
                            <button class="btn btn-secondary" onclick="importData()">üì§ Import Data</button>
                            <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- JavaScript -->
    <script>
        // ===== DATA STORAGE =====
        let transactions = [];
        let settings = {
            currency: 'z≈Ç ',
            restaurantName: '',
            sheetsUrl: '',
            sheetName: 'Transactions',
            sheetsApiUrl: '',
            lastSync: null
        };

        // Revenue Categories
        const revenueCategories = [
            'Food Sales',
            'Beverage Sales',
            'Delivery Sales',
            'Catering',
            'Bar Sales',
            'Takeaway',
            'Other Revenue'
        ];

        // Expense Categories
        const expenseCategories = [
            'Food Costs',
            'Beverage Costs',
            'Wages & Salaries',
            'Rent',
            'Utilities',
            'Marketing',
            'Equipment',
            'Maintenance',
            'Supplies',
            'Insurance',
            'Taxes',
            'Licenses',
            'Other Expenses'
        ];

        // ===== AUTHENTICATION =====
        const AUTH_CREDENTIALS = {
            email: 'admin@cashmany.com',
            password: 'admin123' // Default password, can be changed in settings
        };

        function login(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('authError');

            // Get stored credentials
            const storedPassword = localStorage.getItem('userPassword') || AUTH_CREDENTIALS.password;

            if (email === AUTH_CREDENTIALS.email && password === storedPassword) {
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userEmail', email);
                showApp();
            } else {
                errorDiv.textContent = 'Invalid email or password';
                errorDiv.classList.add('show');
                setTimeout(() => {
                    errorDiv.classList.remove('show');
                }, 3000);
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('isLoggedIn');
                window.location.reload();
            }
        }

        function showApp() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            init();
        }

        function checkAuth() {
            if (localStorage.getItem('isLoggedIn') === 'true') {
                showApp();
            }
        }

        // ===== INITIALIZATION =====
        function init() {
            loadData();
            loadSettings();
            updateCategoryOptions();
            refreshDashboard();
            renderAllTransactions();
            updateUserInfo();
            setDefaultDates();
            checkScreenSize();
        }

        function loadData() {
            const saved = localStorage.getItem('cashflowTransactions');
            if (saved) {
                transactions = JSON.parse(saved);
            }
        }

        function saveData() {
            localStorage.setItem('cashflowTransactions', JSON.stringify(transactions));
            syncToGoogleSheets();
        }

        function loadSettings() {
            const saved = localStorage.getItem('cashflowSettings');
            if (saved) {
                settings = { ...settings, ...JSON.parse(saved) };
                applySettings();
            }
        }

        function saveSettings() {
            localStorage.setItem('cashflowSettings', JSON.stringify(settings));
        }

        function applySettings() {
            if (settings.sheetsApiUrl && settings.sheetsUrl) {
                document.getElementById('syncIndicator').classList.remove('disconnected');
                document.getElementById('syncStatus').textContent = 'Connected';
            }
            document.getElementById('sheetsUrl').value = settings.sheetsUrl || '';
            document.getElementById('sheetName').value = settings.sheetName || 'Transactions';
            document.getElementById('sheetsApiUrl').value = settings.sheetsApiUrl || '';
            document.getElementById('restaurantName').value = settings.restaurantName || '';
            document.getElementById('currency').value = settings.currency || 'z≈Ç';
        }

        function updateUserInfo() {
            const email = localStorage.getItem('userEmail') || AUTH_CREDENTIALS.email;
            document.getElementById('userEmail').textContent = email;
            document.getElementById('userName').textContent = 'Admin User';
            document.getElementById('userAvatar').textContent = email.charAt(0).toUpperCase();
        }

        // ===== NAVIGATION =====
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.closest('.nav-item').classList.add('active');

            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('mobile-show');
            }

            if (sectionId === 'dashboard') {
                refreshDashboard();
            } else if (sectionId === 'transactions') {
                renderAllTransactions();
            }
        }

        function toggleMobileMenu() {
            document.getElementById('sidebar').classList.toggle('mobile-show');
        }

        function checkScreenSize() {
            const menuBtn = document.querySelector('.mobile-menu-btn');
            if (window.innerWidth <= 768) {
                menuBtn.style.display = 'flex';
            } else {
                menuBtn.style.display = 'none';
                document.getElementById('sidebar').classList.remove('mobile-show');
            }
        }

        // ===== TRANSACTION MANAGEMENT =====
        function showAddTransaction(type) {
            document.getElementById('addTransactionForm').style.display = 'block';
            document.getElementById('formTitle').textContent = `Add ${type === 'revenue' ? 'Revenue' : 'Expense'}`;
            document.getElementById('transactionType').value = type;
            document.getElementById('transactionDate').valueAsDate = new Date();
            document.getElementById('editTransactionId').value = '';
            updateCategoryOptions();
            document.getElementById('transactionForm').reset();
            document.getElementById('transactionType').value = type;
            
            // Scroll to form
            document.getElementById('addTransactionForm').scrollIntoView({ behavior: 'smooth' });
        }

        function hideAddTransaction() {
            document.getElementById('addTransactionForm').style.display = 'none';
            document.getElementById('transactionForm').reset();
        }

        function updateCategoryOptions() {
            const type = document.getElementById('transactionType').value;
            const categorySelect = document.getElementById('transactionCategory');
            const categories = type === 'revenue' ? revenueCategories : expenseCategories;
            
            categorySelect.innerHTML = '<option value="">Select Category</option>';
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
            });

            // Update filter category options
            updateFilterCategories();
        }

        function updateFilterCategories() {
            const filterCategory = document.getElementById('filterCategory');
            const allCategories = [...new Set([...revenueCategories, ...expenseCategories])].sort();
            
            filterCategory.innerHTML = '<option value="all">All Categories</option>';
            allCategories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                filterCategory.appendChild(option);
            });
        }

        function saveTransaction(event) {
            event.preventDefault();

            const id = document.getElementById('editTransactionId').value;
            const transaction = {
                id: id || Date.now().toString(),
                type: document.getElementById('transactionType').value,
                category: document.getElementById('transactionCategory').value,
                date: document.getElementById('transactionDate').value,
                amount: parseFloat(document.getElementById('transactionAmount').value),
                notes: document.getElementById('transactionNotes').value,
                createdAt: new Date().toISOString()
            };

            if (id) {
                // Update existing
                const index = transactions.findIndex(t => t.id === id);
                transactions[index] = transaction;
                showToast('Transaction updated successfully!', 'success');
            } else {
                // Add new
                transactions.push(transaction);
                showToast('Transaction added successfully!', 'success');
            }

            saveData();
            hideAddTransaction();
            refreshDashboard();
            renderAllTransactions();
        }

        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;

            document.getElementById('editTransactionId').value = transaction.id;
            document.getElementById('transactionType').value = transaction.type;
            updateCategoryOptions();
            document.getElementById('transactionCategory').value = transaction.category;
            document.getElementById('transactionDate').value = transaction.date;
            document.getElementById('transactionAmount').value = transaction.amount;
            document.getElementById('transactionNotes').value = transaction.notes || '';
            
            document.getElementById('addTransactionForm').style.display = 'block';
            document.getElementById('formTitle').textContent = 'Edit Transaction';
            
            document.getElementById('addTransactionForm').scrollIntoView({ behavior: 'smooth' });
        }

        function deleteTransaction(id) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveData();
                refreshDashboard();
                renderAllTransactions();
                showToast('Transaction deleted successfully!', 'success');
            }
        }

        // ===== DASHBOARD =====
        function refreshDashboard() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();

            // Current month transactions
            const currentMonthTrans = transactions.filter(t => {
                const date = new Date(t.date);
                return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
            });

            // Previous month transactions
            const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            const lastMonthTrans = transactions.filter(t => {
                const date = new Date(t.date);
                return date.getMonth() === lastMonth && date.getFullYear() === lastMonthYear;
            });

            // Calculate totals
            const currentRevenue = currentMonthTrans
                .filter(t => t.type === 'revenue')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const currentExpense = currentMonthTrans
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const currentProfit = currentRevenue - currentExpense;

            const lastRevenue = lastMonthTrans
                .filter(t => t.type === 'revenue')
                .reduce((sum, t) => sum + t.amount, 0);
            
            const lastExpense = lastMonthTrans
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            // Calculate changes
            const revenueChange = lastRevenue > 0 ? ((currentRevenue - lastRevenue) / lastRevenue * 100).toFixed(1) : 0;
            const expenseChange = lastExpense > 0 ? ((currentExpense - lastExpense) / lastExpense * 100).toFixed(1) : 0;

            // Update stats
            document.getElementById('statRevenue').textContent = formatCurrency(currentRevenue);
            document.getElementById('statExpense').textContent = formatCurrency(currentExpense);
            document.getElementById('statProfit').textContent = formatCurrency(currentProfit);
            document.getElementById('statTransactions').textContent = currentMonthTrans.length;

            document.getElementById('revenueChange').textContent = Math.abs(revenueChange) + '%';
            document.getElementById('expenseChange').textContent = Math.abs(expenseChange) + '%';

            // Calculate quick stats
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            document.getElementById('avgDailyRevenue').textContent = formatCurrency(currentRevenue / daysInMonth);
            document.getElementById('avgDailyExpense').textContent = formatCurrency(currentExpense / daysInMonth);
            
            const profitMargin = currentRevenue > 0 ? ((currentProfit / currentRevenue) * 100).toFixed(1) : 0;
            document.getElementById('profitMargin').textContent = profitMargin + '%';

            // Update profit change styling
            const profitChangeEl = document.getElementById('profitChange');
            if (currentProfit > 0) {
                profitChangeEl.classList.add('positive');
                profitChangeEl.classList.remove('negative');
            } else {
                profitChangeEl.classList.add('negative');
                profitChangeEl.classList.remove('positive');
            }

            // Render recent transactions
            renderRecentTransactions();
        }

        function renderRecentTransactions() {
            const tbody = document.getElementById('recentTransactionsTable');
            const recent = [...transactions]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);

            if (recent.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                            <div class="empty-state-icon">üìù</div>
                            <p>No transactions yet. Add your first transaction!</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = recent.map(t => `
                <tr>
                    <td>${formatDate(t.date)}</td>
                    <td><span class="badge badge-${t.type}">${t.type}</span></td>
                    <td>${t.category}</td>
                    <td style="font-weight: 600; color: ${t.type === 'revenue' ? 'var(--success)' : 'var(--danger)'}">
                        ${t.type === 'revenue' ? '+' : '-'}${formatCurrency(t.amount)}
                    </td>
                    <td>${t.notes || '-'}</td>
                    <td>
                        <div class="action-btns">
                            <button class="btn-icon" onclick="editTransaction('${t.id}')" title="Edit">‚úèÔ∏è</button>
                            <button class="btn-icon delete" onclick="deleteTransaction('${t.id}')" title="Delete">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // ===== ALL TRANSACTIONS =====
        function renderAllTransactions() {
            applyFilters();
        }

        function applyFilters() {
            const typeFilter = document.getElementById('filterType').value;
            const categoryFilter = document.getElementById('filterCategory').value;
            const dateFrom = document.getElementById('filterDateFrom').value;
            const dateTo = document.getElementById('filterDateTo').value;

            let filtered = [...transactions];

            if (typeFilter !== 'all') {
                filtered = filtered.filter(t => t.type === typeFilter);
            }

            if (categoryFilter !== 'all') {
                filtered = filtered.filter(t => t.category === categoryFilter);
            }

            if (dateFrom) {
                filtered = filtered.filter(t => t.date >= dateFrom);
            }

            if (dateTo) {
                filtered = filtered.filter(t => t.date <= dateTo);
            }

            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

            const tbody = document.getElementById('allTransactionsTable');

            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 4rem;">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìù</div>
                                <h3>No Transactions Found</h3>
                                <p>Try adjusting your filters or add a new transaction</p>
                                <button class="btn btn-primary" onclick="showAddTransaction('revenue')">Add Transaction</button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = filtered.map(t => `
                <tr>
                    <td>${formatDate(t.date)}</td>
                    <td><span class="badge badge-${t.type}">${t.type}</span></td>
                    <td>${t.category}</td>
                    <td style="font-weight: 600; color: ${t.type === 'revenue' ? 'var(--success)' : 'var(--danger)'}">
                        ${t.type === 'revenue' ? '+' : '-'}${formatCurrency(t.amount)}
                    </td>
                    <td>${t.notes || '-'}</td>
                    <td>
                        <div class="action-btns">
                            <button class="btn-icon" onclick="editTransaction('${t.id}')" title="Edit">‚úèÔ∏è</button>
                            <button class="btn-icon delete" onclick="deleteTransaction('${t.id}')" title="Delete">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // ===== REPORTS =====
        function setDefaultDates() {
            const now = new Date();
            const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
            const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);

            document.getElementById('reportStartDate').valueAsDate = firstDay;
            document.getElementById('reportEndDate').valueAsDate = lastDay;
        }

        function generateReport() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;

            if (!startDate || !endDate) {
                showToast('Please select both start and end dates', 'error');
                return;
            }

            const filtered = transactions.filter(t => t.date >= startDate && t.date <= endDate);

            const revenue = filtered.filter(t => t.type === 'revenue').reduce((sum, t) => sum + t.amount, 0);
            const expense = filtered.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const profit = revenue - expense;

            // Summary cards
            document.getElementById('reportSummary').innerHTML = `
                <div class="stat-card revenue">
                    <div class="stat-header">
                        <div>
                            <div class="stat-label">Total Revenue</div>
                            <div class="stat-value">${formatCurrency(revenue)}</div>
                        </div>
                        <div class="stat-icon">üíµ</div>
                    </div>
                </div>
                <div class="stat-card expense">
                    <div class="stat-header">
                        <div>
                            <div class="stat-label">Total Expenses</div>
                            <div class="stat-value">${formatCurrency(expense)}</div>
                        </div>
                        <div class="stat-icon">üí∏</div>
                    </div>
                </div>
                <div class="stat-card profit">
                    <div class="stat-header">
                        <div>
                            <div class="stat-label">Net Profit</div>
                            <div class="stat-value">${formatCurrency(profit)}</div>
                        </div>
                        <div class="stat-icon">üìä</div>
                    </div>
                </div>
            `;

            // Category breakdown
            generateCategoryBreakdown(filtered);

            showToast('Report generated successfully!', 'success');
        }

        function generateCategoryBreakdown(filteredTrans) {
            const categoryTotals = {};

            filteredTrans.forEach(t => {
                if (!categoryTotals[t.category]) {
                    categoryTotals[t.category] = { revenue: 0, expense: 0 };
                }
                if (t.type === 'revenue') {
                    categoryTotals[t.category].revenue += t.amount;
                } else {
                    categoryTotals[t.category].expense += t.amount;
                }
            });

            const breakdown = Object.entries(categoryTotals).map(([category, amounts]) => ({
                category,
                revenue: amounts.revenue,
                expense: amounts.expense,
                total: amounts.revenue - amounts.expense
            })).sort((a, b) => Math.abs(b.total) - Math.abs(a.total));

            if (breakdown.length === 0) {
                document.getElementById('categoryBreakdown').innerHTML = '<p class="empty-state">No data for selected period</p>';
                return;
            }

            document.getElementById('categoryBreakdown').innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Revenue</th>
                            <th>Expenses</th>
                            <th>Net</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${breakdown.map(b => `
                            <tr>
                                <td style="font-weight: 600;">${b.category}</td>
                                <td style="color: var(--success);">${formatCurrency(b.revenue)}</td>
                                <td style="color: var(--danger);">${formatCurrency(b.expense)}</td>
                                <td style="font-weight: 600; color: ${b.total >= 0 ? 'var(--success)' : 'var(--danger)'}">
                                    ${formatCurrency(b.total)}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // ===== EXPORT FUNCTIONS =====
        function exportToPDF() {
            showToast('PDF export will be available in the next update', 'warning');
        }

        function exportToCSV() {
            let csv = 'Date,Type,Category,Amount,Notes\n';
            const sorted = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sorted.forEach(t => {
                csv += `${t.date},${t.type},${t.category},${t.amount},"${t.notes || ''}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cashflow-export-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);

            showToast('Data exported to CSV successfully!', 'success');
        }

        // ===== GOOGLE SHEETS INTEGRATION =====
        async function syncToGoogleSheets() {
            if (!settings.sheetsApiUrl) return;

            try {
                const lastTransaction = transactions[transactions.length - 1];
                if (!lastTransaction) return;

                const response = await fetch(settings.sheetsApiUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addTransaction',
                        sheetName: settings.sheetName,
                        data: lastTransaction
                    })
                });

                settings.lastSync = new Date().toISOString();
                saveSettings();
                console.log('Synced to Google Sheets');
            } catch (error) {
                console.error('Sync error:', error);
            }
        }

        function testSheetsConnection() {
            const apiUrl = document.getElementById('sheetsApiUrl').value;
            const sheetName = document.getElementById('sheetName').value;

            if (!apiUrl) {
                showToast('Please enter the App Script URL', 'error');
                return;
            }

            // Test with a dummy transaction
            fetch(apiUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'test',
                    sheetName: sheetName
                })
            }).then(() => {
                showToast('Connection test sent! Check your spreadsheet.', 'success');
            }).catch(error => {
                showToast('Connection failed: ' + error.message, 'error');
            });
        }

        function saveSheetsSettings() {
            settings.sheetsUrl = document.getElementById('sheetsUrl').value;
            settings.sheetName = document.getElementById('sheetName').value;
            settings.sheetsApiUrl = document.getElementById('sheetsApiUrl').value;
            
            saveSettings();
            
            if (settings.sheetsApiUrl && settings.sheetsUrl) {
                document.getElementById('syncIndicator').classList.remove('disconnected');
                document.getElementById('syncStatus').textContent = 'Connected';
            }
            
            showToast('Google Sheets settings saved!', 'success');
        }

        // ===== SETTINGS =====
        function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!newPassword) {
                showToast('Please enter a new password', 'error');
                return;
            }

            if (newPassword !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }

            if (newPassword.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }

            localStorage.setItem('userPassword', newPassword);
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            showToast('Password updated successfully!', 'success');
        }

        function saveRestaurantSettings() {
            settings.restaurantName = document.getElementById('restaurantName').value;
            settings.currency = document.getElementById('currency').value;
            saveSettings();
            refreshDashboard();
            showToast('Restaurant settings saved!', 'success');
        }

        function backupData() {
            const backup = {
                transactions,
                settings,
                exportDate: new Date().toISOString(),
                version: '2.0'
            };

            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cashflow-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showToast('Backup created successfully!', 'success');
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];

            if (!file) {
                showToast('Please select a file first', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;

                    if (file.name.endsWith('.json')) {
                        const imported = JSON.parse(content);
                        if (imported.transactions && Array.isArray(imported.transactions)) {
                            transactions = imported.transactions;
                        } else if (Array.isArray(imported)) {
                            transactions = imported;
                        }
                    } else if (file.name.endsWith('.csv')) {
                        const lines = content.split('\n');
                        transactions = [];
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (!line) continue;

                            const match = line.match(/([^,]+),([^,]+),([^,]+),([^,]+),"?([^"]*)"?/);
                            if (match) {
                                transactions.push({
                                    id: Date.now().toString() + Math.random(),
                                    date: match[1],
                                    type: match[2],
                                    category: match[3],
                                    amount: parseFloat(match[4]),
                                    notes: match[5] || '',
                                    createdAt: new Date().toISOString()
                                });
                            }
                        }
                    }

                    saveData();
                    refreshDashboard();
                    renderAllTransactions();
                    showToast(`Imported ${transactions.length} transactions successfully!`, 'success');
                    fileInput.value = '';
                } catch (error) {
                    showToast('Error importing file: ' + error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL data? This cannot be undone!\n\nClick OK to confirm deletion.')) {
                if (confirm('FINAL WARNING: All your data will be permanently deleted. Are you absolutely sure?')) {
                    transactions = [];
                    saveData();
                    refreshDashboard();
                    renderAllTransactions();
                    showToast('All data cleared', 'success');
                }
            }
        }

        // ===== UTILITY FUNCTIONS =====
        function formatCurrency(amount) {
            return `${settings.currency}${amount.toFixed(2)}`;
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ===== EVENT LISTENERS =====
        document.getElementById('loginForm').addEventListener('submit', login);
        document.getElementById('transactionForm').addEventListener('submit', saveTransaction);
        window.addEventListener('resize', checkScreenSize);
        window.addEventListener('load', checkAuth);
    </script>
</body>
</html>